<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>TangramCloud | Cloud tool platform</title>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
    <link rel="stylesheet" type="text/css" href="/static/styles/index.css" />
    <script type="text/javascript" src="/static/scripts/jquery.js"></script>
    <script type="text/javascript" src="/static/scripts/mqttws31.js"></script>
    <script type="text/javascript" src="/static/scripts/term.js"></script>
    <style type="text/css">
    	.terminal {
    	  float: left;
    	  border: #000 solid 5px;
    	  font-family: "DejaVu Sans Mono", "Liberation Mono", monospace;
    	  font-size: 11px;
    	  color: #f0f0f0;
    	  background: #000;
    	}
    	.terminal-cursor {
    	  color: #000;
    	  background: #f0f0f0;
    	}
    </style>
    <script type="text/javascript">

        function getquerystring() {
            var url = location.search;
            var data = new Object();
            if (url.indexOf("?") != -1) {
                var str = url.substr(1);
                strs = str.split("&");
                for (var i = 0; i < strs.length; i++) {
                    data[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
                }
            }
            return data;
        }

        $(function () {
	    var term = new Terminal({
		cols: 180,
		rows: 24,
		useStyle: true,
		screenKeys: true,
		cursorBlink: false
	    });

	    term.open(document.body);

            var d = getquerystring();
            if (!!d['tty']) {
                var ttyid = d['tty'];
                var client = new Paho.MQTT.Client(
                    "192.168.102.86", 9001, '/mqtt', 'webshell/' + ttyid);
                client.onConnectionLost = function (responseObject) {
                    if (responseObject.errorCode !== 0) {
                        term.write("onConnectionLost:" + responseObject.errorMessage);
			term.destroy();
                    }
                }
                client.onMessageArrived = function (message) {
		    term.write(message.payloadString);
                }
                client.connect({
                    onSuccess: function () {
                        client.subscribe('webshell/' + ttyid);
                        message = new Paho.MQTT.Message(ttyid);
                        message.destinationName = "sys/client_ready";
                        client.send(message);
                    }
                });
            }
        });

    </script>
</head>
<body>
</body>
</html>
